node {

    String BRANCH_PLATFORM = ""

    stage ('Checkout') {
        // Checkout code for the pushed branch
        checkout scm
    }

    stage ('Build') {

        def nodeHome = tool 'NodeTool'
        env.PATH="${env.PATH}:${nodeHome}/bin"

        sh '''#!/bin/bash
            cd src/web
            npm install
            bower install
            grunt
        '''
    }

    stage ('Deploy') {
        println "deploy to aws s3"

        step([
            $class: 'S3BucketPublisher',
            entries: [[
                sourceFile: 'src/web/dist/',
                bucket: 'jenkins-test-edobyns',
                selectedRegion: 'us-west-1',
                noUploadOnFailure: true,
                managedArtifacts: true,
                flatten: true,
                showDirectlyInBrowser: true,
                keepForever: true,
            ]],
            profileName: 'edobyns',
            dontWaitForConcurrentBuildCompletion: false, 
        ])

        /*sh '''#!/bin/bash
            aws s3 sync ./src/web/dist/ s3://jenkins-test-edobyns --acl "public-read"
        '''*/
    }
}